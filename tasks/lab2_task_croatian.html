<!DOCTYPE html>
<!-- saved from url=(0031)https://dlunizg.github.io/lab2/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Stranice predmeta Duboko učenje (FER)</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Materijali i laboratorijske vježbe iz predmeta Duboko Učenje">
    <link rel="canonical" href="http://dlunizg.github.io/lab2/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./lab2_task_croatian_files/main.css">

    <!-- Google fonts -->
    <link href="./lab2_task_croatian_files/css" rel="stylesheet" type="text/css">

    <!-- Google tracking -->
    <script async="" src="./lab2_task_croatian_files/analytics.js"></script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46895817-2', 'auto');
      ga('send', 'pageview');

    </script><script data-dapp-detection="">
(function() {
  let alreadyInsertedMetaTag = false

  function __insertDappDetected() {
    if (!alreadyInsertedMetaTag) {
      const meta = document.createElement('meta')
      meta.name = 'dapp-detected'
      document.head.appendChild(meta)
      alreadyInsertedMetaTag = true
    }
  }

  if (window.hasOwnProperty('web3')) {
    // Note a closure can't be used for this var because some sites like
    // www.wnyc.org do a second script execution via eval for some reason.
    window.__disableDappDetectionInsertion = true
    // Likely oldWeb3 is undefined and it has a property only because
    // we defined it. Some sites like wnyc.org are evaling all scripts
    // that exist again, so this is protection against multiple calls.
    if (window.web3 === undefined) {
      return
    }
    __insertDappDetected()
  } else {
    var oldWeb3 = window.web3
    Object.defineProperty(window, 'web3', {
      configurable: true,
      set: function (val) {
        if (!window.__disableDappDetectionInsertion)
          __insertDappDetected()
        oldWeb3 = val
      },
      get: function () {
        if (!window.__disableDappDetectionInsertion)
          __insertDappDetected()
        return oldWeb3
      }
    })
  }
})()</script>
    
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>


    <body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>

    <header class="site-header">

  <div class="wrap title-wrap">
    <a class="site-title" href="http://www.zemris.fer.hr/~ssegvic/du/index.shtml">Stranice predmeta Duboko učenje (FER)</a>
  </div>
  
</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

<!--
  <header class="post-header">
    <h1></h1>
  </header>
-->

  <article class="post-content">
  <ul>
  <li><a href="https://dlunizg.github.io/lab2/#cnn">Konvolucijski modeli</a></li>
  <li><a href="https://dlunizg.github.io/lab2/#vjezba">Vježba</a>
    <ul>
      <li><a href="https://dlunizg.github.io/lab2/#1zad">1. zadatak</a></li>
      <li><a href="https://dlunizg.github.io/lab2/#2zad">2. zadatak</a></li>
      <li><a href="https://dlunizg.github.io/lab2/#3zad">3. zadatak</a></li>
      <li><a href="https://dlunizg.github.io/lab2/#4zad">4. zadatak</a></li>
    </ul>
  </li>
  <li><a href="https://dlunizg.github.io/lab2/#add">Dodatni materijali</a></li>
</ul>

<p><a name="cnn"></a></p>

<h2 id="2-vježba-konvolucijski-modeli-cnn">2. vježba: konvolucijski modeli (CNN)</h2>

<p>U ovoj vježbi bavimo se konvolucijskim modelima. 
Ti modeli prikladni su za obradu podataka s topologijom rešetke, 
gdje je osobito važno ostvariti kovarijantnost na translaciju.
<!--(problem miješanja dimenzija u podacima).-->
Dobar primjer takvih podataka su tipične RGB slike 
u kojima se isti objekt može pojaviti na mnogim prostornim lokacijama. 
Potpuno povezani slojevi nisu prikladni za analizu takvih slika
jer svaka aktivacija ovisi o svim pikselima 
i tako od šume ne vidi stabla. 
Takav pristup bi ohrabrivao specijalizaciju aktivacija 
na pojedine dijelove slike, što bi značilo da bi model
morao odvojeno učiti kako jedan te isti objekt
izgleda u različitim dijelovima slike.
Takva situacija pogodovala bi prenaučenosti, 
odnosno vodila bi na lošu generalizaciju.
Osim toga dodatni problem je što slike 
tipično sadrže puno piksela. 
Na primjer, prosječne dimenzije slike 
iz poznatog skupa ImageNet iznose 3x200x200 
što znači da bi svaka aktivacija iz prvog sloja
trebala imati 3*200*200=120,000 težina. 
Takva situacija je neodrživa 
jer je broj parametara ograničen memorijom GPU-a.</p>

<p>Vidimo da bi puno bolje za nas bilo 
kad bi svaka aktivacija bila lokalno povezana 
s malenim susjedstvom prethodnog sloja, 
jer bi to uvelike smanjilo broj težina. 
Aktivacije u ranim slojevima imale bi malo receptivno polje
i mogle bi modelirati samo jednostavne značajke 
koje bi detektirale jednostavne uzorke poput linija i rubova. 
Kasniji slojevi hijerarhijski bi gradili 
sve kompleksnije i kompleksnije značajke
koje bi imale sve veće i veće receptivno polje.
Nadalje, kovarijantnost na translacije unutar slike
mogli bismo ostvariti dijeljenjem parametara 
aktivacija na različitim prostornim lokacijama. 
U takvoj organizaciji, latentne aktivacije sadrže 
izlaz istog podmodela na različitim lokacijama slike. 
Težine konvolucijskih slojeva obično nazivamo filtrima.
Svaki filtar definira afinu transformaciju
malenog lokalnog susjedstva prethodnog sloja 
koja se naknadno ulančava s nelinearnom aktivacijskom funkcijom.
Tipično, lokalno susjedstvo filtra ima kvadratni oblik 
k✕k, k ∈ {3,5,7}, a nelinearnost je zglobnica.
Da zaključimo, konvolucijski modeli koriste tri važne ideje: 
rijetku povezanost, dijeljenje parametara i
ekvivarijantnost reprezentacije.</p>

<div class="fig figcenter fighighlight">
  <img src="./lab2_task_croatian_files/vv_convnet2.png" width="100%">
  <!--<img src="/assets/lab2/convnet2.png" width="30%">-->
  <div class="figcaption figcenter">Primjer konvolucijskog modela za klasifikaciju slika. 
    Tipično se izmjenjuju konvolucijski slojevi i slojevi sažimanja. 
    Na kraju se dolazi do vektora značajki koji se potpuno povezanim slojem 
    preslikava u konačnu kategoričku distribuciju preko poznatih razreda.
    Slika je preuzeta iz diplomskog rada 
     <a href="http://www.zemris.fer.hr/~ssegvic/project/pubs/vukotic14ms.pdf">Vedrana Vukotića</a>.
  </div>
</div>

<p><a name="vjezba"></a></p>

<h2 id="vježba">Vježba</h2>

<p>Kod za prva dva zadatka nalazi se 
<a href="https://github.com/ivankreso/fer-deep-learning/tree/master/lab2">ovdje</a>.
Biblioteke koje su vam potrebne za ovu vježbu su 
<a href="http://pytorch.org/">PyTorch</a>, 
<a href="https://pytorch.org/docs/stable/torchvision/index.html">torchvision</a>,
NumPy, <a href="http://cython.org/">Cython</a>, 
<a href="http://matplotlib.org/">matplotlib</a> i <a href="http://scikit-image.org/">scikit-image</a>.
Module Pythona najlakše je povući iz pipa.
Druga opcija je koristiti distribucijske pakete. 
Pazite da odaberete verzije za Python 3.</p>

<p>U datoteci <code class="language-plaintext highlighter-rouge">layers.py</code> nalaze se definicije slojeva 
od kojih se mogu graditi duboki konvolucijski modeli.
Svaki sloj sadrži tri metode potrebne za izvođenje algoritma backprop.
Metoda <code class="language-plaintext highlighter-rouge">forward</code> izvodi unaprijedni prolazak kroz sloj i vraća rezultat.
Metode <code class="language-plaintext highlighter-rouge">backward_inputs</code> i <code class="language-plaintext highlighter-rouge">backward_params</code> izvode unatražni prolaz.
Metoda <code class="language-plaintext highlighter-rouge">backward_inputs</code> računa gradijent s obzirom na ulazne podatke 
(<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 1.437em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.181em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.13em, 1001.18em, 2.769em, -999.997em); top: -2.2em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mfrac" id="MathJax-Span-3"><span style="display: inline-block; position: relative; width: 0.976em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.332em, 1000.82em, 4.152em, -999.997em); top: -4.403em; left: 50%; margin-left: -0.407em;"><span class="mrow" id="MathJax-Span-4"><span class="texatom" id="MathJax-Span-5"><span class="mrow" id="MathJax-Span-6"><span class="mo" id="MathJax-Span-7" style="font-size: 70.7%; font-family: MathJax_Main;">∂</span></span></span><span class="mi" id="MathJax-Span-8" style="font-size: 70.7%; font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1000.77em, 4.152em, -999.997em); top: -3.584em; left: 50%; margin-left: -0.407em;"><span class="mrow" id="MathJax-Span-9"><span class="texatom" id="MathJax-Span-10"><span class="mrow" id="MathJax-Span-11"><span class="mo" id="MathJax-Span-12" style="font-size: 70.7%; font-family: MathJax_Main;">∂</span></span></span><span class="texatom" id="MathJax-Span-13"><span class="mrow" id="MathJax-Span-14"><span class="mi" id="MathJax-Span-15" style="font-size: 70.7%; font-family: MathJax_Main-bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1000.98em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.976em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.559em; border-left: 0px solid; width: 0px; height: 1.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mi>L</mi></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></mrow></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-1"> \frac{∂L}{∂\mathbf{x}} </script> gdje je <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-16" style="width: 0.771em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.617em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em, 1000.62em, 2.41em, -999.997em); top: -2.252em; left: 0em;"><span class="mrow" id="MathJax-Span-17"><span class="texatom" id="MathJax-Span-18"><span class="mrow" id="MathJax-Span-19"><span class="mi" id="MathJax-Span-20" style="font-family: MathJax_Main-bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.257em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-2">\mathbf{x}</script> ulaz u sloj).
Metoda  <code class="language-plaintext highlighter-rouge">backward_params</code> računa gradijent s obzirom na parametre sloja (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;w&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-21" style="width: 1.591em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.283em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.13em, 1001.28em, 2.769em, -999.997em); top: -2.2em; left: 0em;"><span class="mrow" id="MathJax-Span-22"><span class="mfrac" id="MathJax-Span-23"><span style="display: inline-block; position: relative; width: 1.078em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.332em, 1000.82em, 4.152em, -999.997em); top: -4.403em; left: 50%; margin-left: -0.407em;"><span class="mrow" id="MathJax-Span-24"><span class="texatom" id="MathJax-Span-25"><span class="mrow" id="MathJax-Span-26"><span class="mo" id="MathJax-Span-27" style="font-size: 70.7%; font-family: MathJax_Main;">∂</span></span></span><span class="mi" id="MathJax-Span-28" style="font-size: 70.7%; font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1000.92em, 4.152em, -999.997em); top: -3.584em; left: 50%; margin-left: -0.459em;"><span class="mrow" id="MathJax-Span-29"><span class="texatom" id="MathJax-Span-30"><span class="mrow" id="MathJax-Span-31"><span class="mo" id="MathJax-Span-32" style="font-size: 70.7%; font-family: MathJax_Main;">∂</span></span></span><span class="texatom" id="MathJax-Span-33"><span class="mrow" id="MathJax-Span-34"><span class="mi" id="MathJax-Span-35" style="font-size: 70.7%; font-family: MathJax_Main-bold;">w</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1001.08em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.078em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.559em; border-left: 0px solid; width: 0px; height: 1.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mi>L</mi></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">w</mi></mrow></mrow></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-3"> \frac{∂L}{∂\mathbf{w}} </script> gdje vektor <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;w&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-36" style="width: 1.027em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.822em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em, 1000.77em, 2.41em, -999.997em); top: -2.252em; left: 0em;"><span class="mrow" id="MathJax-Span-37"><span class="texatom" id="MathJax-Span-38"><span class="mrow" id="MathJax-Span-39"><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Main-bold;">w</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.257em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">w</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-4">\mathbf{w}</script> vektor predstavlja sve parametre sloja)).</p>

<p><a name="1zad"></a></p>

<h3 id="1-zadatak-25">1. zadatak (25%)</h3>
<p>Dovršite implementacije potpuno povezanog sloja, sloja nelinearnosti 
te funkcije gubitka u razredima <code class="language-plaintext highlighter-rouge">FC</code>, <code class="language-plaintext highlighter-rouge">ReLU</code> i <code class="language-plaintext highlighter-rouge">SoftmaxCrossEntropyWithLogits</code>.
Podsjetimo se, gubitak unakrsne entropije računa udaljenost između
točne distribucije i distribucije koju predviđa model i definiran je kao:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 100%; display: inline-block; min-width: 12.707em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(2.615em, 1010.3em, 6.406em, -999.997em); top: -4.506em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-42"><span style="display: inline-block; position: relative; width: 100%; height: 0px;"><span style="position: absolute; clip: rect(2.205em, 1010.3em, 5.587em, -999.997em); top: -4.096em; left: 50%; margin-left: -5.172em;"><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Math-italic;">L</span><span class="mo" id="MathJax-Span-44" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mo" id="MathJax-Span-45" style="font-family: MathJax_Main; padding-left: 0.259em;">−</span><span class="munderover" id="MathJax-Span-46" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-47" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.384em, 1001.13em, 4.408em, -999.997em); top: -2.918em; left: 0.105em;"><span class="texatom" id="MathJax-Span-48"><span class="mrow" id="MathJax-Span-49"><span class="mi" id="MathJax-Span-50" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-51" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-52" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-53"><span class="mrow" id="MathJax-Span-54"><span class="mi" id="MathJax-Span-55" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-56" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-57" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-58" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mi" id="MathJax-Span-59" style="font-family: MathJax_Main; padding-left: 0.156em;">log</span><span class="mo" id="MathJax-Span-60"></span><span class="mo" id="MathJax-Span-61" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-62"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-63" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-64" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-65" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-66"><span class="mrow" id="MathJax-Span-67"><span class="mi" id="MathJax-Span-68" style="font-family: MathJax_Main-bold;">x</span></span></span><span class="mo" id="MathJax-Span-69" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-70" style="font-family: MathJax_Main;">)</span><span class="mspace" id="MathJax-Span-71" style="height: 0em; vertical-align: 0em; width: 0.259em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-72" style="font-family: MathJax_Main;">.</span><span style="display: inline-block; width: 0px; height: 4.101em;"></span></span><span style="position: absolute; clip: rect(3.845em, 1000em, 4.152em, -999.997em); top: -2.252em; left: 50%; margin-left: 0em;"><span class="mspace" id="MathJax-Span-73" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.511em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.184em; border-left: 0px solid; width: 0px; height: 4.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>L</mi><mo>=</mo><mo>−</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msub><mi>y</mi><mi>j</mi></msub><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mspace width="thickmathspace"></mspace><mo>.</mo><mspace linebreak="newline"></mspace></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-5">L = - \sum_{j=1}^{C} y_j \log(p_j(\mathbf{x})) \; .\\</script>

<p>U prikazanoj jednadžbi C predstavlja broj razreda,
a <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-74" style="width: 0.771em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.617em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em, 1000.62em, 2.41em, -999.997em); top: -2.252em; left: 0em;"><span class="mrow" id="MathJax-Span-75"><span class="texatom" id="MathJax-Span-76"><span class="mrow" id="MathJax-Span-77"><span class="mi" id="MathJax-Span-78" style="font-family: MathJax_Main-bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.257em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-6"> \mathbf{x} </script> ulaz funkcije softmaks
kojeg možemo zvati klasifikacijska mjera ili logit.
Vektor <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-79" style="width: 0.771em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.617em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.642em, 1000.57em, 2.615em, -999.997em); top: -2.252em; left: 0em;"><span class="mrow" id="MathJax-Span-80"><span class="texatom" id="MathJax-Span-81"><span class="mrow" id="MathJax-Span-82"><span class="mi" id="MathJax-Span-83" style="font-family: MathJax_Main-bold;">y</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.257em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">y</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-7"> \mathbf{y} </script> sadrži točnu distribuciju 
preko svih razreda za dani primjer.
Tu distribuciju najčešće zadajemo 
jednojediničnim (eng. one-hot) vektorom. 
Skalar <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mtext&gt;softmax&lt;/mtext&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-84" style="width: 8.968em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.328em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.335em, 1007.23em, 2.718em, -999.997em); top: -2.252em; left: 0em;"><span class="mrow" id="MathJax-Span-85"><span class="msubsup" id="MathJax-Span-86"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-87" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-88" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-89" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="msubsup" id="MathJax-Span-90" style="padding-left: 0.259em;"><span style="display: inline-block; position: relative; width: 3.794em; height: 0px;"><span style="position: absolute; clip: rect(3.128em, 1003.43em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mtext" id="MathJax-Span-91" style="font-family: MathJax_Main;">softmax</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 3.435em;"><span class="mi" id="MathJax-Span-92" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-93" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-94"><span class="mrow" id="MathJax-Span-95"><span class="mi" id="MathJax-Span-96" style="font-family: MathJax_Main-bold;">x</span></span></span><span class="mo" id="MathJax-Span-97" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.257em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>j</mi></msub><mo>=</mo><msub><mtext>softmax</mtext><mi>j</mi></msub><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8"> p_j = \text{softmax}_j(\mathbf{x}) </script> predstavlja 
izlaz funkcije softmax za razred <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-98" style="width: 0.515em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.412em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.386em, 1000.41em, 2.564em, -999.997em); top: -2.2em; left: 0em;"><span class="mrow" id="MathJax-Span-99"><span class="mi" id="MathJax-Span-100" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">j</script>.
Radi jednostavnosti, jednadžba prikazuje 
gubitak za samo jedan primjer,
dok ćemo u praksi obično razmatrati 
prosječan gubitak preko svih primjera mini-grupe.
Da biste izveli unatražni prolazak kroz sloj potrebno je najprije izračunati
gradijent gubitka s obzirom na logite <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-101" style="width: 1.437em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.181em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.13em, 1001.18em, 2.769em, -999.997em); top: -2.2em; left: 0em;"><span class="mrow" id="MathJax-Span-102"><span class="mfrac" id="MathJax-Span-103"><span style="display: inline-block; position: relative; width: 0.976em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.332em, 1000.82em, 4.152em, -999.997em); top: -4.403em; left: 50%; margin-left: -0.407em;"><span class="mrow" id="MathJax-Span-104"><span class="texatom" id="MathJax-Span-105"><span class="mrow" id="MathJax-Span-106"><span class="mo" id="MathJax-Span-107" style="font-size: 70.7%; font-family: MathJax_Main;">∂</span></span></span><span class="mi" id="MathJax-Span-108" style="font-size: 70.7%; font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1000.77em, 4.152em, -999.997em); top: -3.584em; left: 50%; margin-left: -0.407em;"><span class="mrow" id="MathJax-Span-109"><span class="texatom" id="MathJax-Span-110"><span class="mrow" id="MathJax-Span-111"><span class="mo" id="MathJax-Span-112" style="font-size: 70.7%; font-family: MathJax_Main;">∂</span></span></span><span class="texatom" id="MathJax-Span-113"><span class="mrow" id="MathJax-Span-114"><span class="mi" id="MathJax-Span-115" style="font-size: 70.7%; font-family: MathJax_Main-bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1000.98em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.976em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.559em; border-left: 0px solid; width: 0px; height: 1.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mi>L</mi></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></mrow></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-10"> \frac{∂L}{∂\mathbf{x}} </script>.
Izvod možemo pojednostavniti tako da 
unaprijed raspišemo funkciju softmax:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mtext&gt;softmax&lt;/mtext&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-116" style="width: 100%; display: inline-block; min-width: 42.779em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(9.634em, 1034.94em, 20.494em, -999.997em); top: -11.524em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-117"><span style="display: inline-block; position: relative; width: 100%; height: 0px;"><span style="position: absolute; clip: rect(2.205em, 1023.21em, 5.587em, -999.997em); top: -4.096em; left: 50%; margin-left: -11.627em;"><span class="mi" id="MathJax-Span-118" style="font-family: MathJax_Main;">log</span><span class="mo" id="MathJax-Span-119"></span><span class="mo" id="MathJax-Span-120" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-121"><span style="display: inline-block; position: relative; width: 3.794em; height: 0px;"><span style="position: absolute; clip: rect(3.128em, 1003.43em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mtext" id="MathJax-Span-122" style="font-family: MathJax_Main;">softmax</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 3.435em;"><span class="mi" id="MathJax-Span-123" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-124" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-125" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-126" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-127" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-128" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mi" id="MathJax-Span-129" style="font-family: MathJax_Main; padding-left: 0.259em;">log</span><span class="mo" id="MathJax-Span-130"></span><span class="mrow" id="MathJax-Span-131"><span class="mo" id="MathJax-Span-132" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="mfrac" id="MathJax-Span-133"><span style="display: inline-block; position: relative; width: 3.947em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.179em, 1001.23em, 4.152em, -999.997em); top: -4.659em; left: 50%; margin-left: -0.612em;"><span class="msubsup" id="MathJax-Span-134"><span style="display: inline-block; position: relative; width: 1.232em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.352em; left: 0.464em;"><span class="texatom" id="MathJax-Span-136"><span class="mrow" id="MathJax-Span-137"><span class="msubsup" id="MathJax-Span-138"><span style="display: inline-block; position: relative; width: 0.669em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-139" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-140" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(2.871em, 1003.85em, 4.46em, -999.997em); top: -3.071em; left: 50%; margin-left: -1.893em;"><span class="mrow" id="MathJax-Span-141"><span class="munderover" id="MathJax-Span-142"><span style="display: inline-block; position: relative; width: 2.41em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1001.03em, 4.408em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1000.62em, 4.152em, -999.997em); top: -4.454em; left: 1.078em;"><span class="texatom" id="MathJax-Span-144"><span class="mrow" id="MathJax-Span-145"><span class="mi" id="MathJax-Span-146" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1001.34em, 4.152em, -999.997em); top: -3.686em; left: 1.078em;"><span class="texatom" id="MathJax-Span-147"><span class="mrow" id="MathJax-Span-148"><span class="mi" id="MathJax-Span-149" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-150" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-151" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-152" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.283em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-153" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.301em; left: 0.464em;"><span class="texatom" id="MathJax-Span-154"><span class="mrow" id="MathJax-Span-155"><span class="msubsup" id="MathJax-Span-156"><span style="display: inline-block; position: relative; width: 0.72em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-157" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-158" style="font-size: 50%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1003.95em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.947em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-159" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span><span class="mo" id="MathJax-Span-160" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="msubsup" id="MathJax-Span-161" style="padding-left: 0.259em;"><span style="display: inline-block; position: relative; width: 0.925em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-162" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-163" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-164" style="font-family: MathJax_Main; padding-left: 0.207em;">−</span><span class="mi" id="MathJax-Span-165" style="font-family: MathJax_Main; padding-left: 0.207em;">log</span><span class="mo" id="MathJax-Span-166"></span><span class="munderover" id="MathJax-Span-167" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-168" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.384em, 1001.13em, 4.408em, -999.997em); top: -2.918em; left: 0.105em;"><span class="texatom" id="MathJax-Span-169"><span class="mrow" id="MathJax-Span-170"><span class="mi" id="MathJax-Span-171" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-172" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-173" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-174"><span class="mrow" id="MathJax-Span-175"><span class="mi" id="MathJax-Span-176" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-177" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.232em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-178" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.403em; left: 0.464em;"><span class="texatom" id="MathJax-Span-179"><span class="mrow" id="MathJax-Span-180"><span class="msubsup" id="MathJax-Span-181"><span style="display: inline-block; position: relative; width: 0.669em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-182" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-183" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.101em;"></span></span><span style="position: absolute; clip: rect(2.205em, 1034.94em, 5.587em, -999.997em); top: -0.561em; left: 50%; margin-left: -17.518em;"><span class="mspace" id="MathJax-Span-184" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-185" style="font-family: MathJax_Math-italic;">L</span><span class="mo" id="MathJax-Span-186" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mo" id="MathJax-Span-187" style="font-family: MathJax_Main; padding-left: 0.259em;">−</span><span class="munderover" id="MathJax-Span-188" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-189" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.384em, 1001.13em, 4.408em, -999.997em); top: -2.918em; left: 0.105em;"><span class="texatom" id="MathJax-Span-190"><span class="mrow" id="MathJax-Span-191"><span class="mi" id="MathJax-Span-192" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-193" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-194" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-195"><span class="mrow" id="MathJax-Span-196"><span class="mi" id="MathJax-Span-197" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-198" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-199" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-200" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mrow" id="MathJax-Span-201" style="padding-left: 0.156em;"><span class="mo" id="MathJax-Span-202" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="mrow" id="MathJax-Span-203"><span class="msubsup" id="MathJax-Span-204"><span style="display: inline-block; position: relative; width: 0.925em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-205" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-206" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-207" style="font-family: MathJax_Main; padding-left: 0.207em;">−</span><span class="mi" id="MathJax-Span-208" style="font-family: MathJax_Main; padding-left: 0.207em;">log</span><span class="mo" id="MathJax-Span-209"></span><span class="munderover" id="MathJax-Span-210" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-211" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1001.23em, 4.255em, -999.997em); top: -2.866em; left: 0.105em;"><span class="texatom" id="MathJax-Span-212"><span class="mrow" id="MathJax-Span-213"><span class="mi" id="MathJax-Span-214" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-215" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-216" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-217"><span class="mrow" id="MathJax-Span-218"><span class="mi" id="MathJax-Span-219" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-220" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.283em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-221" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.403em; left: 0.464em;"><span class="texatom" id="MathJax-Span-222"><span class="mrow" id="MathJax-Span-223"><span class="msubsup" id="MathJax-Span-224"><span style="display: inline-block; position: relative; width: 0.72em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-225" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-226" style="font-size: 50%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-227" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span><span class="mo" id="MathJax-Span-228" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mo" id="MathJax-Span-229" style="font-family: MathJax_Main; padding-left: 0.259em;">−</span><span class="munderover" id="MathJax-Span-230" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-231" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.384em, 1001.13em, 4.408em, -999.997em); top: -2.918em; left: 0.105em;"><span class="texatom" id="MathJax-Span-232"><span class="mrow" id="MathJax-Span-233"><span class="mi" id="MathJax-Span-234" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-235" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-236" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-237"><span class="mrow" id="MathJax-Span-238"><span class="mi" id="MathJax-Span-239" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-240" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-241" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-242" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-243"><span style="display: inline-block; position: relative; width: 0.925em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-244" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-245" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-246" style="font-family: MathJax_Main; padding-left: 0.207em;">+</span><span class="mi" id="MathJax-Span-247" style="font-family: MathJax_Main; padding-left: 0.207em;">log</span><span class="mo" id="MathJax-Span-248"></span><span class="mrow" id="MathJax-Span-249"><span class="mo" id="MathJax-Span-250" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="mrow" id="MathJax-Span-251"><span class="munderover" id="MathJax-Span-252"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-253" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1001.23em, 4.255em, -999.997em); top: -2.866em; left: 0.105em;"><span class="texatom" id="MathJax-Span-254"><span class="mrow" id="MathJax-Span-255"><span class="mi" id="MathJax-Span-256" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-257" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-258" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-259"><span class="mrow" id="MathJax-Span-260"><span class="mi" id="MathJax-Span-261" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-262" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.283em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-263" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.403em; left: 0.464em;"><span class="texatom" id="MathJax-Span-264"><span class="mrow" id="MathJax-Span-265"><span class="msubsup" id="MathJax-Span-266"><span style="display: inline-block; position: relative; width: 0.72em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-267" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-268" style="font-size: 50%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-269" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span><span class="munderover" id="MathJax-Span-270" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-271" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.384em, 1001.13em, 4.408em, -999.997em); top: -2.918em; left: 0.105em;"><span class="texatom" id="MathJax-Span-272"><span class="mrow" id="MathJax-Span-273"><span class="mi" id="MathJax-Span-274" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-275" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-276" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-277"><span class="mrow" id="MathJax-Span-278"><span class="mi" id="MathJax-Span-279" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-280" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-281" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-282" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mspace" id="MathJax-Span-283" style="height: 0em; vertical-align: 0em; width: 0.259em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-284" style="height: 0em; vertical-align: 0em; width: 0.259em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-285" style="font-family: MathJax_Main;">;</span><span class="mspace" id="MathJax-Span-286" style="height: 0em; vertical-align: 0em; width: 0.259em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-287" style="height: 0em; vertical-align: 0em; width: 0.259em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-288" style="height: 0em; vertical-align: 0em; width: 0.259em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-289" style="height: 0em; vertical-align: 0em; width: 0.259em; display: inline-block; overflow: hidden;"></span><span class="munderover" id="MathJax-Span-290" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-291" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.384em, 1001.13em, 4.408em, -999.997em); top: -2.918em; left: 0.105em;"><span class="texatom" id="MathJax-Span-292"><span class="mrow" id="MathJax-Span-293"><span class="mi" id="MathJax-Span-294" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-295" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-296" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-297"><span class="mrow" id="MathJax-Span-298"><span class="mi" id="MathJax-Span-299" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-300" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-301" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-302" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-303" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mn" id="MathJax-Span-304" style="font-family: MathJax_Main; padding-left: 0.259em;">1</span><span style="display: inline-block; width: 0px; height: 4.101em;"></span></span><span style="position: absolute; clip: rect(2.205em, 1012.3em, 5.587em, -999.997em); top: 2.923em; left: 50%; margin-left: -6.145em;"><span class="mspace" id="MathJax-Span-305" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-306" style="font-family: MathJax_Math-italic;">L</span><span class="mo" id="MathJax-Span-307" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mi" id="MathJax-Span-308" style="font-family: MathJax_Main; padding-left: 0.259em;">log</span><span class="mo" id="MathJax-Span-309"></span><span class="mrow" id="MathJax-Span-310"><span class="mo" id="MathJax-Span-311" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="mrow" id="MathJax-Span-312"><span class="munderover" id="MathJax-Span-313"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-314" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1001.23em, 4.255em, -999.997em); top: -2.866em; left: 0.105em;"><span class="texatom" id="MathJax-Span-315"><span class="mrow" id="MathJax-Span-316"><span class="mi" id="MathJax-Span-317" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-318" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-319" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-320"><span class="mrow" id="MathJax-Span-321"><span class="mi" id="MathJax-Span-322" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-323" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.283em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-324" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.403em; left: 0.464em;"><span class="texatom" id="MathJax-Span-325"><span class="mrow" id="MathJax-Span-326"><span class="msubsup" id="MathJax-Span-327"><span style="display: inline-block; position: relative; width: 0.72em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-328" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-329" style="font-size: 50%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-330" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span><span class="mo" id="MathJax-Span-331" style="font-family: MathJax_Main; padding-left: 0.207em;">−</span><span class="munderover" id="MathJax-Span-332" style="padding-left: 0.207em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-333" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.384em, 1001.13em, 4.408em, -999.997em); top: -2.918em; left: 0.105em;"><span class="texatom" id="MathJax-Span-334"><span class="mrow" id="MathJax-Span-335"><span class="mi" id="MathJax-Span-336" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-337" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-338" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-339"><span class="mrow" id="MathJax-Span-340"><span class="mi" id="MathJax-Span-341" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-342" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-343" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-344" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-345"><span style="display: inline-block; position: relative; width: 0.925em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-346" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-347" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.101em;"></span></span><span style="position: absolute; clip: rect(3.845em, 1000em, 4.152em, -999.997em); top: 4.818em; left: 50%; margin-left: 0em;"><span class="mspace" id="MathJax-Span-348" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 11.529em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -10.809em; border-left: 0px solid; width: 0px; height: 13.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mtext>softmax</mtext><mi>j</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><mfrac><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>j</mi></msub></mrow></msup><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow></mfrac><mo>)</mo></mrow><mo>=</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><mi>log</mi><mo>⁡</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>j</mi></msub></mrow></msup><mspace linebreak="newline"></mspace><mi>L</mi><mo>=</mo><mo>−</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msub><mi>y</mi><mi>j</mi></msub><mrow><mo>(</mo><mrow><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><mi>log</mi><mo>⁡</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow><mo>)</mo></mrow><mo>=</mo><mo>−</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msub><mi>y</mi><mi>j</mi></msub><msub><mi>x</mi><mi>j</mi></msub><mo>+</mo><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow><mo>)</mo></mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msub><mi>y</mi><mi>j</mi></msub><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><mo>;</mo><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn><mspace linebreak="newline"></mspace><mi>L</mi><mo>=</mo><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow><mo>)</mo></mrow><mo>−</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msub><mi>y</mi><mi>j</mi></msub><msub><mi>x</mi><mi>j</mi></msub><mspace linebreak="newline"></mspace></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-11">\log(\text{softmax}_j(x)) 
  = \log \left(
    \frac{e^{x_j}}{\sum_{k=1}^{C} e^{x_k}}
   \right) 
  = x_j - \log \sum_{j=1}^{C} e^{x_j} 
\\
L 
  = - \sum_{j=1}^{C} y_j 
   \left(
    x_j - \log \sum_{k=1}^{C} e^{x_k}\right) 
  = - \sum_{j=1}^{C} y_j x_j + 
    \log \left(
      \sum_{k=1}^{C} e^{x_k}
     \right) 
    \sum_{j=1}^{C} y_j \;\; ; 
    \;\;\;\; 
    \sum_{j=1}^{C} y_j = 1 
\\
L = 
 \log \left(
  \sum_{k=1}^{C} e^{x_k}
 \right) 
 - \sum_{j=1}^{C} y_j x_j \\</script>

<p>Sada možemo jednostavno izračunati derivaciju 
funkcije cilja s obzirom na k-ti logit <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-349" style="width: 1.283em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.027em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.591em, 1001.03em, 2.513em, -999.997em); top: -2.2em; left: 0em;"><span class="mrow" id="MathJax-Span-350"><span class="msubsup" id="MathJax-Span-351"><span style="display: inline-block; position: relative; width: 1.027em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-352" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-353" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>k</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-12"> x_k </script>:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mtext&gt;softmax&lt;/mtext&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mtext&gt;softmax&lt;/mtext&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/msub&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-354" style="width: 100%; display: inline-block; min-width: 26.078em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(8.712em, 1021.26em, 18.599em, -999.997em); top: -10.602em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-355"><span style="display: inline-block; position: relative; width: 100%; height: 0px;"><span style="position: absolute; clip: rect(2.205em, 1016.7em, 5.587em, -999.997em); top: -4.096em; left: 50%; margin-left: -8.348em;"><span class="mfrac" id="MathJax-Span-356"><span style="display: inline-block; position: relative; width: 1.488em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.128em, 1001.18em, 4.152em, -999.997em); top: -4.659em; left: 50%; margin-left: -0.612em;"><span class="mrow" id="MathJax-Span-357"><span class="texatom" id="MathJax-Span-358"><span class="mrow" id="MathJax-Span-359"><span class="mo" id="MathJax-Span-360" style="font-family: MathJax_Main;">∂</span></span></span><span class="mi" id="MathJax-Span-361" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.128em, 1001.39em, 4.306em, -999.997em); top: -3.327em; left: 50%; margin-left: -0.715em;"><span class="mrow" id="MathJax-Span-362"><span class="texatom" id="MathJax-Span-363"><span class="mrow" id="MathJax-Span-364"><span class="mo" id="MathJax-Span-365" style="font-family: MathJax_Main;">∂</span></span></span><span class="msubsup" id="MathJax-Span-366"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-367" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-368" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1001.49em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.488em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-369" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mfrac" id="MathJax-Span-370"><span style="display: inline-block; position: relative; width: 1.488em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.128em, 1000.57em, 4.152em, -999.997em); top: -4.659em; left: 50%; margin-left: -0.254em;"><span class="texatom" id="MathJax-Span-371"><span class="mrow" id="MathJax-Span-372"><span class="mo" id="MathJax-Span-373" style="font-family: MathJax_Main;">∂</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.128em, 1001.39em, 4.306em, -999.997em); top: -3.327em; left: 50%; margin-left: -0.715em;"><span class="mrow" id="MathJax-Span-374"><span class="texatom" id="MathJax-Span-375"><span class="mrow" id="MathJax-Span-376"><span class="mo" id="MathJax-Span-377" style="font-family: MathJax_Main;">∂</span></span></span><span class="msubsup" id="MathJax-Span-378"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-379" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-380" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1001.49em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.488em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mi" id="MathJax-Span-381" style="font-family: MathJax_Main; padding-left: 0.156em;">log</span><span class="mo" id="MathJax-Span-382"></span><span class="mrow" id="MathJax-Span-383"><span class="mo" id="MathJax-Span-384" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="mrow" id="MathJax-Span-385"><span class="munderover" id="MathJax-Span-386"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-387" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1001.23em, 4.255em, -999.997em); top: -2.866em; left: 0.105em;"><span class="texatom" id="MathJax-Span-388"><span class="mrow" id="MathJax-Span-389"><span class="mi" id="MathJax-Span-390" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-391" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-392" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-393"><span class="mrow" id="MathJax-Span-394"><span class="mi" id="MathJax-Span-395" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-396" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.283em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-397" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.403em; left: 0.464em;"><span class="texatom" id="MathJax-Span-398"><span class="mrow" id="MathJax-Span-399"><span class="msubsup" id="MathJax-Span-400"><span style="display: inline-block; position: relative; width: 0.72em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-401" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-402" style="font-size: 50%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-403" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span><span class="mo" id="MathJax-Span-404" style="font-family: MathJax_Main; padding-left: 0.207em;">−</span><span class="mfrac" id="MathJax-Span-405"><span style="display: inline-block; position: relative; width: 1.488em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.128em, 1000.57em, 4.152em, -999.997em); top: -4.659em; left: 50%; margin-left: -0.254em;"><span class="texatom" id="MathJax-Span-406"><span class="mrow" id="MathJax-Span-407"><span class="mo" id="MathJax-Span-408" style="font-family: MathJax_Main;">∂</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.128em, 1001.39em, 4.306em, -999.997em); top: -3.327em; left: 50%; margin-left: -0.715em;"><span class="mrow" id="MathJax-Span-409"><span class="texatom" id="MathJax-Span-410"><span class="mrow" id="MathJax-Span-411"><span class="mo" id="MathJax-Span-412" style="font-family: MathJax_Main;">∂</span></span></span><span class="msubsup" id="MathJax-Span-413"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-414" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-415" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1001.49em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.488em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="munderover" id="MathJax-Span-416" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-417" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.384em, 1001.13em, 4.408em, -999.997em); top: -2.918em; left: 0.105em;"><span class="texatom" id="MathJax-Span-418"><span class="mrow" id="MathJax-Span-419"><span class="mi" id="MathJax-Span-420" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-421" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-422" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-423"><span class="mrow" id="MathJax-Span-424"><span class="mi" id="MathJax-Span-425" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-426" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-427" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-428" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-429"><span style="display: inline-block; position: relative; width: 0.925em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-430" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-431" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.101em;"></span></span><span style="position: absolute; clip: rect(2.103em, 1021.26em, 5.382em, -999.997em); top: -0.459em; left: 50%; margin-left: -10.653em;"><span class="mspace" id="MathJax-Span-432" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span class="mfrac" id="MathJax-Span-433"><span style="display: inline-block; position: relative; width: 1.488em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.128em, 1000.57em, 4.152em, -999.997em); top: -4.659em; left: 50%; margin-left: -0.254em;"><span class="texatom" id="MathJax-Span-434"><span class="mrow" id="MathJax-Span-435"><span class="mo" id="MathJax-Span-436" style="font-family: MathJax_Main;">∂</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.128em, 1001.39em, 4.306em, -999.997em); top: -3.327em; left: 50%; margin-left: -0.715em;"><span class="mrow" id="MathJax-Span-437"><span class="texatom" id="MathJax-Span-438"><span class="mrow" id="MathJax-Span-439"><span class="mo" id="MathJax-Span-440" style="font-family: MathJax_Main;">∂</span></span></span><span class="msubsup" id="MathJax-Span-441"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-442" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-443" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1001.49em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.488em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mi" id="MathJax-Span-444" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-445" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-446" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mrow" id="MathJax-Span-447" style="padding-left: 0.156em;"><span class="mo" id="MathJax-Span-448" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="mrow" id="MathJax-Span-449"><span class="munderover" id="MathJax-Span-450"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(2.871em, 1001.39em, 4.613em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-451" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1001.23em, 4.255em, -999.997em); top: -2.866em; left: 0.105em;"><span class="texatom" id="MathJax-Span-452"><span class="mrow" id="MathJax-Span-453"><span class="mi" id="MathJax-Span-454" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-455" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-456" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.23em, 1000.51em, 4.152em, -999.997em); top: -5.12em; left: 0.464em;"><span class="texatom" id="MathJax-Span-457"><span class="mrow" id="MathJax-Span-458"><span class="mi" id="MathJax-Span-459" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-460" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.283em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-461" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.403em; left: 0.464em;"><span class="texatom" id="MathJax-Span-462"><span class="mrow" id="MathJax-Span-463"><span class="msubsup" id="MathJax-Span-464"><span style="display: inline-block; position: relative; width: 0.72em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-465" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-466" style="font-size: 50%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-467" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span><span class="mo" id="MathJax-Span-468" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mfrac" id="MathJax-Span-469" style="padding-left: 0.259em;"><span style="display: inline-block; position: relative; width: 3.947em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.179em, 1000.41em, 4.152em, -999.997em); top: -4.659em; left: 50%; margin-left: -0.254em;"><span class="mn" id="MathJax-Span-470" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(2.871em, 1003.85em, 4.46em, -999.997em); top: -3.071em; left: 50%; margin-left: -1.893em;"><span class="mrow" id="MathJax-Span-471"><span class="munderover" id="MathJax-Span-472"><span style="display: inline-block; position: relative; width: 2.41em; height: 0px;"><span style="position: absolute; clip: rect(3.076em, 1001.03em, 4.408em, -999.997em); top: -3.993em; left: 0em;"><span class="mo" id="MathJax-Span-473" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1000.62em, 4.152em, -999.997em); top: -4.454em; left: 1.078em;"><span class="texatom" id="MathJax-Span-474"><span class="mrow" id="MathJax-Span-475"><span class="mi" id="MathJax-Span-476" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.332em, 1001.34em, 4.152em, -999.997em); top: -3.686em; left: 1.078em;"><span class="texatom" id="MathJax-Span-477"><span class="mrow" id="MathJax-Span-478"><span class="mi" id="MathJax-Span-479" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-480" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-481" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-482" style="padding-left: 0.156em;"><span style="display: inline-block; position: relative; width: 1.283em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-483" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.301em; left: 0.464em;"><span class="texatom" id="MathJax-Span-484"><span class="mrow" id="MathJax-Span-485"><span class="msubsup" id="MathJax-Span-486"><span style="display: inline-block; position: relative; width: 0.72em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-487" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-488" style="font-size: 50%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1003.95em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.947em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-489" style="font-family: MathJax_Main; padding-left: 0.207em;">⋅</span><span class="msubsup" id="MathJax-Span-490" style="padding-left: 0.207em;"><span style="display: inline-block; position: relative; width: 1.13em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-491" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.403em; left: 0.464em;"><span class="texatom" id="MathJax-Span-492"><span class="mrow" id="MathJax-Span-493"><span class="msubsup" id="MathJax-Span-494"><span style="display: inline-block; position: relative; width: 0.617em; height: 0px;"><span style="position: absolute; clip: rect(3.537em, 1000.36em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-495" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.891em; left: 0.412em;"><span class="mi" id="MathJax-Span-496" style="font-size: 50%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-497" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="msubsup" id="MathJax-Span-498" style="padding-left: 0.259em;"><span style="display: inline-block; position: relative; width: 3.742em; height: 0px;"><span style="position: absolute; clip: rect(3.128em, 1003.43em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mtext" id="MathJax-Span-499" style="font-family: MathJax_Main;">softmax</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 3.435em;"><span class="mi" id="MathJax-Span-500" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-501" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-502"><span class="mrow" id="MathJax-Span-503"><span class="mi" id="MathJax-Span-504" style="font-family: MathJax_Main-bold;">x</span></span></span><span class="mo" id="MathJax-Span-505" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(2.462em, 1010.15em, 4.972em, -999.997em); top: 2.615em; left: 50%; margin-left: -5.069em;"><span class="mspace" id="MathJax-Span-506" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span class="mfrac" id="MathJax-Span-507"><span style="display: inline-block; position: relative; width: 1.488em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.128em, 1001.18em, 4.152em, -999.997em); top: -4.659em; left: 50%; margin-left: -0.612em;"><span class="mrow" id="MathJax-Span-508"><span class="texatom" id="MathJax-Span-509"><span class="mrow" id="MathJax-Span-510"><span class="mo" id="MathJax-Span-511" style="font-family: MathJax_Main;">∂</span></span></span><span class="mi" id="MathJax-Span-512" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.128em, 1001.39em, 4.306em, -999.997em); top: -3.327em; left: 50%; margin-left: -0.715em;"><span class="mrow" id="MathJax-Span-513"><span class="texatom" id="MathJax-Span-514"><span class="mrow" id="MathJax-Span-515"><span class="mo" id="MathJax-Span-516" style="font-family: MathJax_Main;">∂</span></span></span><span class="msubsup" id="MathJax-Span-517"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-518" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.566em;"><span class="mi" id="MathJax-Span-519" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1001.49em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.488em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-520" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="msubsup" id="MathJax-Span-521" style="padding-left: 0.259em;"><span style="display: inline-block; position: relative; width: 3.742em; height: 0px;"><span style="position: absolute; clip: rect(3.128em, 1003.43em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mtext" id="MathJax-Span-522" style="font-family: MathJax_Main;">softmax</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 3.435em;"><span class="mi" id="MathJax-Span-523" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-524" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-525"><span class="mrow" id="MathJax-Span-526"><span class="mi" id="MathJax-Span-527" style="font-family: MathJax_Main-bold;">x</span></span></span><span class="mo" id="MathJax-Span-528" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-529" style="font-family: MathJax_Main; padding-left: 0.207em;">−</span><span class="msubsup" id="MathJax-Span-530" style="padding-left: 0.207em;"><span style="display: inline-block; position: relative; width: 0.771em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.51em, 4.357em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-531" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -3.84em; left: 0.515em;"><span class="mi" id="MathJax-Span-532" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.845em, 1000em, 4.152em, -999.997em); top: 3.845em; left: 50%; margin-left: 0em;"><span class="mspace" id="MathJax-Span-533" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 10.607em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -9.622em; border-left: 0px solid; width: 0px; height: 11.878em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mi>L</mi></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><msub><mi>x</mi><mi>l</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><msub><mi>x</mi><mi>l</mi></msub></mrow></mfrac><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow><mo>)</mo></mrow><mo>−</mo><mfrac><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><msub><mi>x</mi><mi>l</mi></msub></mrow></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msub><mi>y</mi><mi>j</mi></msub><msub><mi>x</mi><mi>j</mi></msub><mspace linebreak="newline"></mspace><mfrac><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><msub><mi>x</mi><mi>l</mi></msub></mrow></mfrac><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow><mo>)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>C</mi></mrow></munderover><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>k</mi></msub></mrow></msup></mrow></mfrac><mo>⋅</mo><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mi>l</mi></msub></mrow></msup><mo>=</mo><msub><mtext>softmax</mtext><mi>l</mi></msub><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mi>L</mi></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><msub><mi>x</mi><mi>l</mi></msub></mrow></mfrac><mo>=</mo><msub><mtext>softmax</mtext><mi>l</mi></msub><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow><mo stretchy="false">)</mo><mo>−</mo><msub><mi>y</mi><mi>l</mi></msub><mspace linebreak="newline"></mspace></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-13">\frac{∂L}{∂x_l} = 
    \frac{∂}{∂x_l} 
    \log \left(
     \sum_{k=1}^{C} e^{x_k}
    \right) 
    - 
    \frac{∂}{∂x_l} \sum_{j=1}^{C} y_j x_j 
  \\
  \frac{∂}{∂x_l} 
    log \left(
     \sum_{k=1}^{C} e^{x_k}
    \right)
    = \frac{1}{
       \sum_{k=1}^{C} e^{x_k}} \cdot e^{x_l}
    = \text{softmax}_l(\mathbf{x}) 
  \\
  \frac{∂L}{∂x_l} 
    = \text{softmax}_l(\mathbf{x}) - y_l \\</script>

<p>Konačno, gradijent s obzirom na sve logite
dobivamo kao vektorsku razliku između<br>
predikcije modela i točne distribucije:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2202;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;softmax&lt;/mtext&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;mspace linebreak=&quot;newline&quot; /&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-534" style="width: 100%; display: inline-block; min-width: 11.58em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(2.462em, 1009.48em, 5.33em, -999.997em); top: -3.993em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-535"><span style="display: inline-block; position: relative; width: 100%; height: 0px;"><span style="position: absolute; clip: rect(2.462em, 1009.48em, 4.869em, -999.997em); top: -3.993em; left: 50%; margin-left: -4.762em;"><span class="mfrac" id="MathJax-Span-536"><span style="display: inline-block; position: relative; width: 1.335em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.128em, 1001.18em, 4.152em, -999.997em); top: -4.659em; left: 50%; margin-left: -0.612em;"><span class="mrow" id="MathJax-Span-537"><span class="texatom" id="MathJax-Span-538"><span class="mrow" id="MathJax-Span-539"><span class="mo" id="MathJax-Span-540" style="font-family: MathJax_Main;">∂</span></span></span><span class="mi" id="MathJax-Span-541" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.128em, 1001.13em, 4.152em, -999.997em); top: -3.327em; left: 50%; margin-left: -0.561em;"><span class="mrow" id="MathJax-Span-542"><span class="texatom" id="MathJax-Span-543"><span class="mrow" id="MathJax-Span-544"><span class="mo" id="MathJax-Span-545" style="font-family: MathJax_Main;">∂</span></span></span><span class="texatom" id="MathJax-Span-546"><span class="mrow" id="MathJax-Span-547"><span class="mi" id="MathJax-Span-548" style="font-family: MathJax_Main-bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(0.873em, 1001.34em, 1.232em, -999.997em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.335em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.078em;"></span></span></span></span><span class="mo" id="MathJax-Span-549" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mtext" id="MathJax-Span-550" style="font-family: MathJax_Main; padding-left: 0.259em;">softmax</span><span class="mo" id="MathJax-Span-551" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-552"><span class="mrow" id="MathJax-Span-553"><span class="mi" id="MathJax-Span-554" style="font-family: MathJax_Main-bold;">x</span></span></span><span class="mo" id="MathJax-Span-555" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-556" style="font-family: MathJax_Main; padding-left: 0.207em;">−</span><span class="texatom" id="MathJax-Span-557" style="padding-left: 0.207em;"><span class="mrow" id="MathJax-Span-558"><span class="mi" id="MathJax-Span-559" style="font-family: MathJax_Main-bold;">y</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; clip: rect(3.845em, 1000em, 4.152em, -999.997em); top: -2.815em; left: 50%; margin-left: 0em;"><span class="mspace" id="MathJax-Span-560" style="height: 0em; vertical-align: 0em; width: 0em; display: inline-block; overflow: hidden;"></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left: 0px solid; width: 0px; height: 3.316em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mi>L</mi></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mo>∂</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></mrow></mfrac><mo>=</mo><mtext>softmax</mtext><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow><mo stretchy="false">)</mo><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">y</mi></mrow><mspace linebreak="newline"></mspace></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-14">\frac{∂L}{∂\mathbf{x}} = \text{softmax}(\mathbf{x}) - \mathbf{y} \\</script>

<p>Kako biste bili sigurni da ste ispravno napisali sve slojeve 
testirajte gradijente pozivom skripte <code class="language-plaintext highlighter-rouge">check_grads.py</code>.
Zadovoljavajuća relativna greška bi trebala biti manja od <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-561" style="width: 2.462em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.001em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.181em, 1002em, 2.359em, -999.997em); top: -2.2em; left: 0em;"><span class="mrow" id="MathJax-Span-562"><span class="msubsup" id="MathJax-Span-563"><span style="display: inline-block; position: relative; width: 2.001em; height: 0px;"><span style="position: absolute; clip: rect(3.179em, 1000.98em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mn" id="MathJax-Span-564" style="font-family: MathJax_Main;">10</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.403em; left: 1.027em;"><span class="texatom" id="MathJax-Span-565"><span class="mrow" id="MathJax-Span-566"><span class="mo" id="MathJax-Span-567" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-568" style="font-size: 70.7%; font-family: MathJax_Main;">5</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>10</mn><mrow class="MJX-TeXAtom-ORD"><mo>−</mo><mn>5</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-15">10^{-5}</script> 
ako vaši tenzori imaju dvostruku preciznost.
Proučite izvorni kod te skripte jer će vam 
ta funkcionalnost biti vrlo korisna za treću vježbu.
Razmislite zašto pri učenju dubokih modela radije koristimo 
analitičke nego numeričke gradijente.</p>

<p>Sada prevedite Cython modul <code class="language-plaintext highlighter-rouge">im2col_cython.pyx</code> 
pozivom <code class="language-plaintext highlighter-rouge">python3 setup_cython.py build_ext --inplace</code>
te po potrebi izmijenite varijable <code class="language-plaintext highlighter-rouge">DATA_DIR</code> i <code class="language-plaintext highlighter-rouge">SAVE_DIR</code>. 
Proučite izvorni kod funkcija <code class="language-plaintext highlighter-rouge">col2im_cython</code> i <code class="language-plaintext highlighter-rouge">im2col_cython</code>
te istražite kako se te funkcije koriste.</p>

<p>Proučite i skicirajte model zadan objektom <code class="language-plaintext highlighter-rouge">net</code> u skripti <code class="language-plaintext highlighter-rouge">train.py</code>.
Odredite veličine tenzora te broj parametara u svakom sloju.
Odredite veličinu receptivnog polja značajki 
iz posljednjeg (drugog) konvolucijskog sloja.
Procijenite ukupnu količinu memorije za pohranjivanje aktivacija 
koje su potrebne za provođenje backpropa
ako učimo s mini-grupama od 50 slika.</p>

<p>Napokon, pokrenite učenje modela pozivom skripte <code class="language-plaintext highlighter-rouge">train.py</code>. 
Odredite vezu između početnog iznosa funkcije gubitka i broja razreda C.
Tijekom učenja možete promatrati vizualizaciju filtara 
koji se spremaju u kazalo <code class="language-plaintext highlighter-rouge">SAVE_DIR</code>.
Budući da svaka težina odgovara jednom pikselu slike, 
u vašem pregledniku isključite automatsko glađenje slike.
Preporuka je da na Linuxu koristite preglednik Geeqie.</p>

<p><a name="2zad"></a></p>

<h3 id="2-zadatak-25">2. zadatak (25%)</h3>

<p>U ovom zadatku trebate dodati podršku za
L2 regularizaciju parametara.
Dovršite implementaciju sloja <code class="language-plaintext highlighter-rouge">L2Regularizer</code>
te naučite regularizirani model iz
prethodnog zadatka koji se nalazi u <code class="language-plaintext highlighter-rouge">train_l2reg.py</code>.
Proučite efekte regularizacijskog hiper-parametra
tako da naučite tri različita modela s
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-569" style="width: 15.013em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.298em; height: 0px; font-size: 122%;"><span style="position: absolute; clip: rect(1.232em, 1012.3em, 2.564em, -999.997em); top: -2.2em; left: 0em;"><span class="mrow" id="MathJax-Span-570"><span class="mi" id="MathJax-Span-571" style="font-family: MathJax_Math-italic;">λ</span><span class="mo" id="MathJax-Span-572" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mn" id="MathJax-Span-573" style="font-family: MathJax_Main; padding-left: 0.259em;">1</span><span class="msubsup" id="MathJax-Span-574"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-575" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.352em; left: 0.464em;"><span class="texatom" id="MathJax-Span-576"><span class="mrow" id="MathJax-Span-577"><span class="mo" id="MathJax-Span-578" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-579" style="font-size: 70.7%; font-family: MathJax_Main;">3</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-580" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-581" style="font-family: MathJax_Math-italic; padding-left: 0.156em;">λ</span><span class="mo" id="MathJax-Span-582" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mn" id="MathJax-Span-583" style="font-family: MathJax_Main; padding-left: 0.259em;">1</span><span class="msubsup" id="MathJax-Span-584"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-585" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.352em; left: 0.464em;"><span class="texatom" id="MathJax-Span-586"><span class="mrow" id="MathJax-Span-587"><span class="mo" id="MathJax-Span-588" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-589" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span><span class="mo" id="MathJax-Span-590" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-591" style="font-family: MathJax_Math-italic; padding-left: 0.156em;">λ</span><span class="mo" id="MathJax-Span-592" style="font-family: MathJax_Main; padding-left: 0.259em;">=</span><span class="mn" id="MathJax-Span-593" style="font-family: MathJax_Main; padding-left: 0.259em;">1</span><span class="msubsup" id="MathJax-Span-594"><span style="display: inline-block; position: relative; width: 1.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em, 1000.41em, 4.152em, -999.997em); top: -3.993em; left: 0em;"><span class="mi" id="MathJax-Span-595" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span><span style="position: absolute; top: -4.352em; left: 0.464em;"><span class="texatom" id="MathJax-Span-596"><span class="mrow" id="MathJax-Span-597"><span class="mo" id="MathJax-Span-598" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-599" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.998em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.205em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>λ</mi><mo>=</mo><mn>1</mn><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>−</mo><mn>3</mn></mrow></msup><mo>,</mo><mi>λ</mi><mo>=</mo><mn>1</mn><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>−</mo><mn>2</mn></mrow></msup><mo>,</mo><mi>λ</mi><mo>=</mo><mn>1</mn><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>−</mo><mn>1</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-16"> \lambda = 1e^{-3}, \lambda=1e^{-2}, \lambda=1e^{-1} </script>
te usporedite naučene filtre u prvom sloju i dobivenu točnost.</p>

<!---
Minimalno je potrebno izmijeniti update\_params metode.
Dodajte novi sloj L2Loss koji na ulazu forward metode prima tenzor težine te
implementirajte odgovarajući unaprijedni i unazadni prolazak.
Dodajte novi sloj MultiLoss koji na ulaz prima listu funkcija cilja te računa njihov zbroj.
Konačna funkcija cilja je sada MultiLoss koji u našem slučaju na ulazu treba dobiti
listu u kojoj se nalazi funkcija cilja unakrsne entropije i L2 regularizacije težina
konvolucijskih i potpuno povezanih slojeva.
-->

<div class="fig figcenter fighighlight">
  <img src="./lab2_task_croatian_files/filters1_big.png" width="80%">
  <img src="./lab2_task_croatian_files/filters2_big.png" width="80%">
  <div class="figcaption">Slučajno inicijalizirani filtri u prvom sloju na početku učenja (iznad) i naučeni filtri (ispod) s regularizacijom lambda = 0.01.</div>
</div>

<p><a name="3zad"></a></p>

<h3 id="3-zadatak---usporedba-s-pytorchem-25">3. zadatak - usporedba s PyTorchem (25%)</h3>
<p>U PyTorchu definirajte i naučite model koji je ekvivalentan regulariziranom modelu iz 2. zadatka.
Koristite identičnu arhitekturu i parametre učenja da biste reproducirali rezultate.
Konvoluciju zadajte operacijama <a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Conv2d"><code class="language-plaintext highlighter-rouge">torch.nn.Conv2d</code></a>
ili <a href="https://pytorch.org/docs/stable/nn.functional.html#torch.nn.functional.conv2d"><code class="language-plaintext highlighter-rouge">torch.nn.functional.conv2d</code></a>.
U nastavku teksta navodimo primjer korištenja konvolucije razredom <code class="language-plaintext highlighter-rouge">torch.nn.Conv2d</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
 
<span class="k">class</span> <span class="nc">CovolutionalModel</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">conv1_width</span><span class="p">,</span> <span class="p">...,</span> <span class="n">fc1_width</span><span class="p">,</span> <span class="n">class_count</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">conv1_width</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># ostatak konvolucijskih slojeva i slojeva sažimanja
</span>    <span class="p">...</span>
    <span class="c1"># potpuno povezani slojevi
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(...,</span> <span class="n">fc1_width</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">fc_logits</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">fc1_width</span><span class="p">,</span> <span class="n">class_count</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># parametri su već inicijalizirani pozivima Conv2d i Linear
</span>    <span class="c1"># ali možemo ih drugačije inicijalizirati
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">reset_parameters</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">modules</span><span class="p">():</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nn</span><span class="p">.</span><span class="n">Conv2d</span><span class="p">):</span>
        <span class="n">nn</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">kaiming_normal_</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'fan_in'</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
        <span class="n">nn</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">bias</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">fc_logits</span><span class="p">:</span>
        <span class="n">nn</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">kaiming_normal_</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'fan_in'</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
        <span class="n">nn</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">bias</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">fc_logits</span><span class="p">.</span><span class="n">reset_parameters</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">relu</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>  <span class="c1"># može i h.relu() ili nn.functional.relu(h)
</span>    <span class="p">...</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">view</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">relu</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">fc_logits</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logits</span>

</code></pre></div></div>

<p>Ako želite koristiti <code class="language-plaintext highlighter-rouge">torch.nn.functional.conv2d</code>, vodite računa o ručnom definiranju parametara
tipa <a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Parameter"><code class="language-plaintext highlighter-rouge">torch.nn.Parameter</code></a>.
Pritom se poslužite slijedećim <a href="https://pytorch.org/docs/stable/notes/extending.html#adding-a-module">primjerom</a>.
Vodite računa o odgovarajućoj dimenzionalnosti tenzora konvolucijskih jezgara te tenzora pomaka.</p>

<p>Tijekom učenja vizualizirajte filtre u prvom sloju kao u prethodnoj vježbi.
Nakon svake epohe učenja pohranite filtre i gubitak u datoteku (ili koristite <a href="https://pytorch.org/docs/stable/tensorboard.html">Tensorboard</a>).</p>

<p>Na kraju učenja prikažite kretanje gubitka kroz epohe (Matplotlib).</p>

<p>Za razliku od 1. vježbe, u ovoj za iteriranje i uzorkovanje mini-grupa možete koristiti <code class="language-plaintext highlighter-rouge">torch.nn.data.DataLoader</code>, 
o kojem <a href="https://pytorch.org/docs/stable/data.html">ovdje</a> možete naći više.</p>

<p><a name="4zad"></a></p>
<h3 id="4-zadatak---klasifikacija-na-skupu-cifar-10-25">4. zadatak - Klasifikacija na skupu CIFAR-10 (25%)</h3>
<p>Skup podataka <a href="https://www.cs.toronto.edu/~kriz/cifar.html">CIFAR-10</a> sastoji se od 50000 slika za učenje i validaciju te 10000 slika za
testiranje dimenzija 32x32 podijeljenih u 10 razreda.
Najprije skinite dataset pripremljen za Python <a href="https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz">odavde</a> ili korištenjem <a href="https://pytorch.org/docs/stable/torchvision/datasets.html#cifar"><code class="language-plaintext highlighter-rouge">torchvision.datasets.CIFAR10</code></a>.
Možete iskoristiti sljedeći kod kako biste učitali podatke i pripremili ih.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">def</span> <span class="nf">shuffle_data</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">):</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">data_x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
  <span class="n">shuffled_data_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
  <span class="n">shuffled_data_y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">data_y</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">shuffled_data_x</span><span class="p">,</span> <span class="n">shuffled_data_y</span>

<span class="k">def</span> <span class="nf">unpickle</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
  <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
  <span class="nb">dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">fo</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'latin1'</span><span class="p">)</span>
  <span class="n">fo</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
  <span class="k">return</span> <span class="nb">dict</span>

<span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s">'/path/to/data/'</span>

<span class="n">img_height</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">img_width</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">num_channels</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num_classes</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">train_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">img_height</span> <span class="o">*</span> <span class="n">img_width</span> <span class="o">*</span> <span class="n">num_channels</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
  <span class="n">subset</span> <span class="o">=</span> <span class="n">unpickle</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s">'data_batch_%d'</span> <span class="o">%</span> <span class="n">i</span><span class="p">))</span>
  <span class="n">train_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">train_x</span><span class="p">,</span> <span class="n">subset</span><span class="p">[</span><span class="s">'data'</span><span class="p">]))</span>
  <span class="n">train_y</span> <span class="o">+=</span> <span class="n">subset</span><span class="p">[</span><span class="s">'labels'</span><span class="p">]</span>
<span class="n">train_x</span> <span class="o">=</span> <span class="n">train_x</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_channels</span><span class="p">,</span> <span class="n">img_height</span><span class="p">,</span> <span class="n">img_width</span><span class="p">)).</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>

<span class="n">subset</span> <span class="o">=</span> <span class="n">unpickle</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="s">'test_batch'</span><span class="p">))</span>
<span class="n">test_x</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s">'data'</span><span class="p">].</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_channels</span><span class="p">,</span> <span class="n">img_height</span><span class="p">,</span> <span class="n">img_width</span><span class="p">)).</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">test_y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s">'labels'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>

<span class="n">valid_size</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span> <span class="o">=</span> <span class="n">shuffle_data</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
<span class="n">valid_x</span> <span class="o">=</span> <span class="n">train_x</span><span class="p">[:</span><span class="n">valid_size</span><span class="p">,</span> <span class="p">...]</span>
<span class="n">valid_y</span> <span class="o">=</span> <span class="n">train_y</span><span class="p">[:</span><span class="n">valid_size</span><span class="p">,</span> <span class="p">...]</span>
<span class="n">train_x</span> <span class="o">=</span> <span class="n">train_x</span><span class="p">[</span><span class="n">valid_size</span><span class="p">:,</span> <span class="p">...]</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="n">train_y</span><span class="p">[</span><span class="n">valid_size</span><span class="p">:,</span> <span class="p">...]</span>
<span class="n">data_mean</span> <span class="o">=</span> <span class="n">train_x</span><span class="p">.</span><span class="n">mean</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">data_std</span> <span class="o">=</span> <span class="n">train_x</span><span class="p">.</span><span class="n">std</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">train_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">train_x</span> <span class="o">-</span> <span class="n">data_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">data_std</span>
<span class="n">valid_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">valid_x</span> <span class="o">-</span> <span class="n">data_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">data_std</span>
<span class="n">test_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_x</span> <span class="o">-</span> <span class="n">data_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">data_std</span>

<span class="n">train_x</span> <span class="o">=</span> <span class="n">train_x</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">valid_x</span> <span class="o">=</span> <span class="n">valid_x</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_x</span> <span class="o">=</span> <span class="n">test_x</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<p>Vaš zadatak je da u PyTorchu naučite konvolucijski model na ovom skupu.
U nastavku je prijedlog jednostavnog modela 
s kojom biste trebali dobiti ukupnu točnost oko 70% na validacijskom skupu:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conv(16,5) -&gt; relu() -&gt; pool(3,2) -&gt; conv(32,5) -&gt; relu() -&gt; pool(3,2) -&gt; fc(256) -&gt; relu() -&gt; fc(128) -&gt; relu() -&gt; fc(10)
</code></pre></div></div>
<p>gdje <code class="language-plaintext highlighter-rouge">conv(16,5)</code> predstavlja konvoluciju sa 16 mapa te dimenzijom filtra 5x5, 
a <code class="language-plaintext highlighter-rouge">pool(3,2)</code> max-pooling sloj s oknom veličine 3x3 i pomakom (<em>stride</em>) 2.
Prilikom treniranja padajuću stopu učenja možete implementirati korištenjem
<code class="language-plaintext highlighter-rouge">torch.optim.lr_scheduler.ExponentialLR</code>.</p>

<p>Napišite funkciju <code class="language-plaintext highlighter-rouge">evaluate</code> koja na temelju predviđenih i točnih indeksa razreda određuje pokazatelje klasifikacijske performanse:
ukupnu točnost klasifikacije, matricu zabune (engl. confusion matrix) u kojoj retci odgovaraju točnim razredima a stupci predikcijama te mjere preciznosti
i odziva pojedinih razreda. U implementaciji prvo izračunajte matricu zabune, a onda sve ostale pokazatelje na temelju nje.
Tijekom učenja pozivajte funkciju <code class="language-plaintext highlighter-rouge">evaluate</code> nakon svake epohe na skupu za učenje i
validacijskom skupu te na grafu pratite sljedeće vrijednosti: prosječnu vrijednost
funkcije gubitka, stopu učenja te ukupnu točnost klasifikacije.
Preporuka je da funkciji provedete samo
unaprijedni prolaz kroz dane primjere koristeći <code class="language-plaintext highlighter-rouge">torch.no_grad()</code> i pritom izračunati matricu zabune.
Pazite da slučajno ne pozovete i operaciju koja provodi učenje tijekom evaluacije.
Na kraju funkcije možete izračunati ostale pokazatelje te ih isprintati.</p>

<div class="fig figcenter fighighlight">
  <img src="./lab2_task_croatian_files/training_plot.png" width="100%">
  <div class="figcaption figcenter">Primjer grafa učenja za navedeni model uz veličinu grupe od 50</div>
</div>

<p>Vizualizirajte slučajno inicijalizirane
težine konvolucijskog sloja možeze dohvatiti
korištenjem 
<code class="language-plaintext highlighter-rouge">conv.weight</code>.
U nastavku je primjer kako to može izgledati, ovisno
o načinu implementacije konvolucijske mreže.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">net</span> <span class="o">=</span> <span class="n">ConvNet</span><span class="p">()</span>

<span class="n">draw_conv_filters</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">net</span><span class="p">.</span><span class="n">conv1</span><span class="p">.</span><span class="n">weight</span><span class="p">.</span><span class="n">detach</span><span class="p">().</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">SAVE_DIR</span><span class="p">)</span>
</code></pre></div></div>

<p>U nastavku se nalazi kod koji možete
koristiti za vizualizaciju:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_conv_filters</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">):</span>
  <span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">num_filters</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">num_channels</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">k</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="k">assert</span> <span class="n">w</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">w</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="n">w</span> <span class="o">-=</span> <span class="n">w</span><span class="p">.</span><span class="nb">min</span><span class="p">()</span>
  <span class="n">w</span> <span class="o">/=</span> <span class="n">w</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span>
  <span class="n">border</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">cols</span> <span class="o">=</span> <span class="mi">8</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_filters</span> <span class="o">/</span> <span class="n">cols</span><span class="p">)</span>
  <span class="n">width</span> <span class="o">=</span> <span class="n">cols</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="p">(</span><span class="n">cols</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">border</span>
  <span class="n">height</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="p">(</span><span class="n">rows</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">border</span>
  <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">num_channels</span><span class="p">])</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_filters</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">border</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">border</span><span class="p">)</span>
    <span class="n">img</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">r</span><span class="o">+</span><span class="n">k</span><span class="p">,</span><span class="n">c</span><span class="p">:</span><span class="n">c</span><span class="o">+</span><span class="n">k</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:,:,:,</span><span class="n">i</span><span class="p">]</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="s">'epoch_%02d_step_%06d.png'</span> <span class="o">%</span> <span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
  <span class="n">ski</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">img</span><span class="p">)</span>
</code></pre></div></div>

<div class="fig figcenter fighighlight">
  <img src="./lab2_task_croatian_files/cifar_filters1.png" width="80%">
  <img src="./lab2_task_croatian_files/cifar_filters2.png" width="80%">
  <div class="figcaption figcenter">CIFAR-10: slučajno inicijalizirani filtri u prvom sloju na početku učenja (iznad) i naučeni filtri (ispod) s regularizacijom lambda = 0.0001.</div>
</div>

<p>Prikažite 20 netočno klasificiranih slika s najvećim gubitkom te ispišite njihov točan razred,
kao i 3 razreda za koje je model dao najveću vjerojatnost.
Da biste prikazali sliku, morate najprije poništiti normalizaciju srednje vrijednosti i
varijance:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">skimage</span> <span class="k">as</span> <span class="n">ski</span>
<span class="kn">import</span> <span class="nn">skimage.io</span>

<span class="k">def</span> <span class="nf">draw_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
  <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="n">img</span> <span class="o">*=</span> <span class="n">std</span>
  <span class="n">img</span> <span class="o">+=</span> <span class="n">mean</span>
  <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>
  <span class="n">ski</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
  <span class="n">ski</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p>Ispod se nalazi kod koji možete iskoristiti za crtanje grafova:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_training_progress</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
  <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">),</span> <span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

  <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">legend_size</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="n">train_color</span> <span class="o">=</span> <span class="s">'m'</span>
  <span class="n">val_color</span> <span class="o">=</span> <span class="s">'c'</span>

  <span class="n">num_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'train_loss'</span><span class="p">])</span>
  <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>
  <span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Cross-entropy loss'</span><span class="p">)</span>
  <span class="n">ax1</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">'train_loss'</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">train_color</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'train'</span><span class="p">)</span>
  <span class="n">ax1</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">'valid_loss'</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">val_color</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'validation'</span><span class="p">)</span>
  <span class="n">ax1</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'upper right'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_size</span><span class="p">)</span>
  <span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Average class accuracy'</span><span class="p">)</span>
  <span class="n">ax2</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">'train_acc'</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">train_color</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'train'</span><span class="p">)</span>
  <span class="n">ax2</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">'valid_acc'</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">val_color</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'validation'</span><span class="p">)</span>
  <span class="n">ax2</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'upper left'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_size</span><span class="p">)</span>
  <span class="n">ax3</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Learning rate'</span><span class="p">)</span>
  <span class="n">ax3</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">'lr'</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">train_color</span><span class="p">,</span>
           <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'learning_rate'</span><span class="p">)</span>
  <span class="n">ax3</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'upper left'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_size</span><span class="p">)</span>

  <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="s">'training_plot.png'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">'Plotting in: '</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">plot_data</span><span class="p">[</span><span class="s">'train_loss'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">plot_data</span><span class="p">[</span><span class="s">'valid_loss'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">plot_data</span><span class="p">[</span><span class="s">'train_acc'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">plot_data</span><span class="p">[</span><span class="s">'valid_acc'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">plot_data</span><span class="p">[</span><span class="s">'lr'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Yoh</span> <span class="o">=</span> <span class="n">shuffle_data</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">Yoh</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">Yoh</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_batch</span><span class="p">):</span>
        <span class="c1"># broj primjera djeljiv s veličinom grupe bsz
</span>        <span class="n">batch_X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">batch</span><span class="o">*</span><span class="n">bsz</span><span class="p">:(</span><span class="n">batch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bsz</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">batch_Yoh</span> <span class="o">=</span> <span class="n">Yoh</span><span class="p">[</span><span class="n">batch</span><span class="o">*</span><span class="n">bsz</span><span class="p">:(</span><span class="n">batch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bsz</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">loss</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">get_loss</span><span class="p">(</span><span class="n">batch_X</span><span class="p">,</span> <span class="n">batch_Yoh</span><span class="p">)</span>
        <span class="n">loss</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">batch</span><span class="o">%</span><span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"epoch: {}, step: {}/{}, batch_loss: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="n">loss</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">batch</span><span class="o">%</span><span class="mi">200</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">draw_conv_filters</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">conv1</span><span class="p">.</span><span class="n">weight</span><span class="p">.</span><span class="n">detach</span><span class="p">().</span><span class="n">cpu</span><span class="p">().</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">SAVE_DIR</span><span class="p">)</span>


    <span class="n">train_loss</span><span class="p">,</span> <span class="n">train_acc</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
    <span class="n">val_loss</span><span class="p">,</span> <span class="n">val_acc</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">valid_x</span><span class="p">,</span> <span class="n">valid_labels</span><span class="p">)</span>

    <span class="n">plot_data</span><span class="p">[</span><span class="s">'train_loss'</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">train_loss</span><span class="p">]</span>
    <span class="n">plot_data</span><span class="p">[</span><span class="s">'valid_loss'</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">val_loss</span><span class="p">]</span>
    <span class="n">plot_data</span><span class="p">[</span><span class="s">'train_acc'</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">train_acc</span><span class="p">]</span>
    <span class="n">plot_data</span><span class="p">[</span><span class="s">'valid_acc'</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">val_acc</span><span class="p">]</span>
    <span class="n">plot_data</span><span class="p">[</span><span class="s">'lr'</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">lr_scheduler</span><span class="p">.</span><span class="n">get_lr</span><span class="p">()]</span>
    <span class="n">lr_scheduler</span><span class="p">.</span><span class="n">step</span><span class="p">()</span>

<span class="n">plot_training_progress</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">,</span> <span class="n">plot_data</span><span class="p">)</span>
</code></pre></div></div>

<p>Ukoliko imate GPU, možda će vam biti zanimljivo pokušati dobiti bolje rezultate s moćnijom
arhitekturom. U tom slučaju <a href="http://rodrigob.github.io/are_we_there_yet/build/classification_datasets_results.html#43494641522d3130">ovdje</a>
možete pronaći pregled članaka koji imaju najbolje rezultate na ovom skupu.
Kao što vidite trenutni <em>state of the art</em> je oko 96% ukupne točnosti.
Dva važna trika koje koriste najbolje arhitekture su skaliranje slika na veću rezoluciju
kako bi omogućili da prvi konvolucijski slojevi uče značajke jako niske razine
te proširivanje skupa za učenje raznim modificiranjem slika (<em>data jittering</em>).
Bez ovih trikova je jako teško preći preko 90% ukupne točnosti.</p>

<h3 id="bonus-zadatak---multiclass-hinge-loss-max-20">Bonus zadatak - Multiclass hinge loss (max 20%)</h3>

<p>Ovaj zadatak razmatra učenje modela za slike iz CIFARA
s alternativnom formulacijom gubitka
koju nismo obradili na predavanjima.
Cilj je zamijeniti unakrsnu entropiju 
višerazrednom inačicom gubitka zglobnice.
Objašnjenje tog gubitka možete pronaći 
<a href="http://cs231n.github.io/linear-classify/#svm">ovdje</a>.
Za sve bodove zadatak je potrebno riješiti
primjenom osnovnih PyTorch operacija nad tenzorima
te usporediti postignute rezultate.</p>

<p>Pomoć: sučelje nove funkcije gubitka
moglo bi izgledati ovako:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def multiclass_hinge_loss(logits: torch.Tensor, target: torch.Tensor, delta=1.):  
    """
        Args:
            logits: torch.Tensor with shape (B, C), where B is batch size, and C is number of classes.
            target: torch.LongTensor with shape (B, ) representing ground truth labels.
            delta: Hyperparameter.
        Returns:
            Loss as scalar torch.Tensor.
    """
</code></pre></div></div>
<p>Rješenje možete započeti razdvajanjem 
izlaza posljednjeg potpuno povezanog sloja
na vektor logita točnih razreda
i matricu logita netočnih razreda.
To možete provesti pozivom funkcije
<a href="https://pytorch.org/docs/stable/torch.html#torch.masked_select">torch.masked_select</a>,
pri čemu masku zadajete regularnom odnosno invertiranom 
verzijom matrice s jednojediničnim oznakama podataka.
Sada razliku između matrice logita netočnih razreda
i vektora logita točnih razreda
možemo izračunati običnim oduzimanjem,
jer PyTorch automatski umnaža (eng. broadcast) operand nižeg reda.
Pripazite da sve tenzore preoblikujete na ispravni oblik,
jer funkcija <code class="language-plaintext highlighter-rouge">torch.masked_select</code> vraća tenzor prvog reda.
Maksimum po elementima možete računati 
odgovarajućom varijantom funkcije 
<a href="https://pytorch.org/docs/stable/torch.html#torch.max">torch.max</a>.</p>

<!--
  [torch.nn.functional.one_hot](https://pytorch.org/docs/stable/nn.functional.html#one-hot)
 -->
<!--
Pokušajte u zadnjem zadatku unakrsnu entropiju zamijeniti 
višerazrednim gubitkom zglobnice te usporedite rezultate. 
Objašnjenje tog gubitka možete pronaći [ovdje](http://cs231n.github.io/linear-classify/#svm).
Za sve bodove zadatak je potrebno ostvariti 
primjenom osnovnih Tensorflowovih operacija nad tenzorima. 

Pomoć: jedna opcija kako to možete izvesti je da razdvojite logite
(izlazi iz zadnjeg potpuno povezanog sloja) na matricu logita netočnih razreda i vektor
logita na mjestima točnih razreda.
To možete izvesti pomoću operacija `tf.dynamic_partition` i `tf.one_hot`.
Zatim unutar `tf.maximum` računate razliku 
između matrice logita na netočnim razredima 
i vektora logita na točnim razredima. 
To možete napisati kao običnu razliku 
jer za tenzore različitih dimenzija 
Tensorflow po defaultu napravi *broadcasting* 
ako je to moguće.
-->

<p><a name="add"></a></p>

<h3 id="dodatni-materijali">Dodatni materijali</h3>

<ul>
  <li><a href="http://www.deeplearningbook.org/contents/convnets.html">Deep learning book</a></li>
  <li><a href="http://cs231n.github.io/">CS231n Convolutional Neural Networks for Visual Recognition</a></li>
</ul>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <div class="footer-col-1 column">
      <ul>
        
        <li>
          <a href="https://github.com/dlunizg">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path>
              </svg>
            </span>
            <span class="username">dlunizg</span>
          </a>
        </li>
        
        <li>
          <a href="mailto:ivan.kreso@fer.hr">ivan.kreso@fer.hr</a>
        </li>
      </ul>
    </div>

    <div class="footer-col-2 column">
        
    </div>

    <div class="footer-col-3 column">
      
    </div>

  </div>

</footer>


    <!-- mathjax -->
    <script src="./lab2_task_croatian_files/MathJax.js" id=""></script>
    
<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Size4, sans-serif;"></div></div></body></html>